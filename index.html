<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Valuasi Saham</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    margin:0;
    padding:40px;
}

.container {
    max-width:700px;
    margin:auto;
    background:white;
    padding:30px;
    border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

h2 {
    text-align:center;
}

input {
    width:100%;
    padding:12px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #ccc;
}

button {
    width:100%;
    padding:12px;
    background:#007bff;
    color:white;
    border:none;
    border-radius:6px;
    font-size:16px;
    cursor:pointer;
}

button:hover {
    background:#0056b3;
}

.result {
    margin-top:20px;
    padding:15px;
    border-radius:6px;
    background:#eef2f7;
}
</style>
</head>

<body>

<div class="container">
<h2>Auto Valuasi Saham</h2>

<label>Kode Saham</label>
<input type="text" id="symbol" placeholder="Contoh: AAPL atau BBCA">

<button onclick="analisa()">Analisa Otomatis</button>

<div id="output" class="result"></div>

</div>

<script>

const API_KEY = "T9127G8F7LKAJRQU";

async function analisa(){

    const symbol = document.getElementById("symbol").value.toUpperCase();
    const output = document.getElementById("output");

    if(!symbol){
        output.innerHTML = "Masukkan kode saham terlebih dahulu.";
        return;
    }

    output.innerHTML = "Mengambil data dari server...";

    try {

        // Ambil Harga
        const priceRes = await fetch(
        `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`
        );
        const priceData = await priceRes.json();

        if(!priceData["Global Quote"] || !priceData["Global Quote"]["05. price"]){
            output.innerHTML = "Data harga tidak ditemukan atau limit API tercapai.";
            return;
        }

        const price = parseFloat(priceData["Global Quote"]["05. price"]);

        // Ambil Fundamental
        const overviewRes = await fetch(
        `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${API_KEY}`
        );
        const overviewData = await overviewRes.json();

        const eps = overviewData.EPS ? parseFloat(overviewData.EPS) : null;
        const per = overviewData.PERatio ? parseFloat(overviewData.PERatio) : null;
        const growth = overviewData.QuarterlyEarningsGrowthYOY 
            ? parseFloat(overviewData.QuarterlyEarningsGrowthYOY) * 100
            : null;

        let html = `
            <b>Kode:</b> ${symbol} <br>
            <b>Harga:</b> ${price.toFixed(2)} <br><br>
        `;

        if(eps && per && growth){

            const peg = per / growth;
            const fairPER = growth;
            const fairPrice = eps * fairPER;

            let status = "";

            if(price > fairPrice*1.2){
                status = "SANGAT MAHAL";
            } else if(price > fairPrice){
                status = "MAHAL";
            } else if(price < fairPrice*0.8){
                status = "MURAH";
            } else {
                status = "WAJAR";
            }

            html += `
                <b>EPS:</b> ${eps.toFixed(2)} <br>
                <b>PER:</b> ${per.toFixed(2)} <br>
                <b>Growth (YoY):</b> ${growth.toFixed(2)}% <br>
                <b>PEG:</b> ${peg.toFixed(2)} <br><br>
                <b>Estimasi Harga Wajar:</b> ${fairPrice.toFixed(2)} <br><br>
                <b>Status:</b> <b>${status}</b>
            `;

        } else {
            html += "Data fundamental (EPS / Growth) tidak tersedia untuk saham ini.";
        }

        output.innerHTML = html;

    } catch(error){
        output.innerHTML = "Terjadi error koneksi atau limit API tercapai.";
    }
}

</script>

</body>
</html>
