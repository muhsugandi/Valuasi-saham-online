<script>

const API_KEY = "T9127G8F7LKAJRQU";

async function analisa(){

    const symbol = document.getElementById("symbol").value.toUpperCase();
    const output = document.getElementById("output");

    if(!symbol){
        output.innerHTML = "Masukkan kode saham.";
        return;
    }

    output.innerHTML = "Mengambil data...";

    try {

        const priceRes = await fetch(
        `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`
        );
        const priceData = await priceRes.json();

        if(!priceData["Global Quote"] || !priceData["Global Quote"]["05. price"]){
            output.innerHTML = "Data harga tidak ditemukan atau limit API tercapai.";
            return;
        }

        const price = parseFloat(priceData["Global Quote"]["05. price"]);

        const overviewRes = await fetch(
        `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${API_KEY}`
        );
        const overviewData = await overviewRes.json();

        const eps = overviewData.EPS ? parseFloat(overviewData.EPS) : null;
        const per = overviewData.PERatio ? parseFloat(overviewData.PERatio) : null;
        const growth = overviewData.QuarterlyEarningsGrowthYOY 
            ? parseFloat(overviewData.QuarterlyEarningsGrowthYOY) * 100
            : null;

        let resultHTML = `
            <b>Kode:</b> ${symbol} <br>
            <b>Harga:</b> ${price.toFixed(2)} <br><br>
        `;

        if(eps && per && growth){

            const peg = per / growth;
            const fairPER = growth;
            const fairPrice = eps * fairPER;

            let status = "";

            if(price > fairPrice*1.2){
                status = "SANGAT MAHAL";
            } else if(price > fairPrice){
                status = "MAHAL";
            } else if(price < fairPrice*0.8){
                status = "MURAH";
            } else {
                status = "WAJAR";
            }

            resultHTML += `
                <b>EPS:</b> ${eps.toFixed(2)} <br>
                <b>PER:</b> ${per.toFixed(2)} <br>
                <b>Growth:</b> ${growth.toFixed(2)}% <br>
                <b>PEG:</b> ${peg.toFixed(2)} <br><br>
                <b>Estimasi Harga Wajar:</b> ${fairPrice.toFixed(2)} <br><br>
                <b>Status:</b> ${status}
            `;
        } else {
            resultHTML += "Data fundamental (EPS / Growth) tidak tersedia untuk saham ini.";
        }

        output.innerHTML = resultHTML;

    } catch(error){
        output.innerHTML = "Terjadi error koneksi atau limit API tercapai.";
    }
}

</script>
