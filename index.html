<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auto Valuasi Saham Indonesia</title>
<style>
body{font-family:Arial;background:#f4f6f9;padding:40px}
.container{max-width:700px;margin:auto;background:white;padding:30px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
input,button{width:100%;padding:12px;margin:10px 0;border-radius:6px;border:1px solid #ccc}
button{background:#007bff;color:white;border:none;font-size:16px}
button:hover{background:#0056b3}
.result{margin-top:20px;padding:15px;background:#eef2f7;border-radius:6px}
</style>
</head>
<body>

<div class="container">
<h2>Auto Valuasi Saham BEI</h2>

<input type="text" id="symbol" placeholder="Contoh: BBCA atau BBRI">
<button onclick="analisa()">Analisa</button>

<div id="output" class="result"></div>
</div>

<script>

async function analisa(){

    let symbol = document.getElementById("symbol").value.toUpperCase();
    const output = document.getElementById("output");

    if(!symbol){
        output.innerHTML = "Masukkan kode saham.";
        return;
    }

    symbol = symbol + ".JK";

    output.innerHTML = "Mengambil data dari Yahoo Finance...";

    try{

        const url = `https://query1.finance.yahoo.com/v10/finance/quoteSummary/${symbol}?modules=price,defaultKeyStatistics,financialData`;

        const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;

        const res = await fetch(proxy);
        const data = await res.json();
        const json = JSON.parse(data.contents);

        const result = json.quoteSummary.result[0];

        const price = result.price.regularMarketPrice.raw;
        const eps = result.defaultKeyStatistics.trailingEps.raw;

        if(!eps){
            output.innerHTML = "EPS tidak tersedia untuk saham ini.";
            return;
        }

        const per = price / eps;

        // Ambil growth dari earnings trend (jika ada)
        let growth = 10; // default asumsi 10% jika tidak tersedia

        if(result.financialData.earningsGrowth){
            growth = result.financialData.earningsGrowth.raw * 100;
        }

        const peg = per / growth;

        const fairPER = growth;
        const fairPrice = eps * fairPER;

        let status = "";

        if(price > fairPrice*1.2){
            status = "SANGAT MAHAL";
        } else if(price > fairPrice){
            status = "MAHAL";
        } else if(price < fairPrice*0.8){
            status = "MURAH";
        } else {
            status = "WAJAR";
        }

        output.innerHTML = `
        <b>Kode:</b> ${symbol}<br><br>
        <b>Harga:</b> ${price.toFixed(2)}<br>
        <b>EPS (TTM):</b> ${eps.toFixed(2)}<br>
        <b>PER:</b> ${per.toFixed(2)}<br>
        <b>Growth:</b> ${growth.toFixed(2)}%<br>
        <b>PEG:</b> ${peg.toFixed(2)}<br><br>
        <b>Estimasi Harga Wajar:</b> ${fairPrice.toFixed(2)}<br><br>
        <b>Status:</b> <b>${status}</b>
        `;

    }catch(error){
        output.innerHTML = "Terjadi error mengambil data.";
        console.log(error);
    }
}

</script>

</body>
</html>
